[gd_scene load_steps=15 format=2]

[ext_resource path="res://icon.png" type="Texture" id=1]
[ext_resource path="res://assets/3d/cena_3/cap_3.tres" type="Material" id=2]

[sub_resource type="PlaneMesh" id=1]
material = ExtResource( 2 )
size = Vector2( 18, 18 )

[sub_resource type="CubeMesh" id=11]
size = Vector3( 16, 4, 1 )

[sub_resource type="Shader" id=2]
code = "shader_type spatial;

uniform sampler2D tex;
uniform sampler2D noise;

varying vec3 uv_triplanar_pos;
varying vec3 uv_power_normal;

void vertex(){
	uv_power_normal = pow(abs(mat3(WORLD_MATRIX) * NORMAL), vec3(1.0));
	uv_triplanar_pos = (WORLD_MATRIX * vec4(VERTEX, 1.0f)).xyz * 0.5;
	uv_power_normal /= dot(uv_power_normal, vec3(1.0));
	uv_triplanar_pos *= vec3(1.0, -1.0, 1.0);
}

vec4 triplanar_texture(sampler2D p_sampler,vec3 p_triplanar_pos, vec3 p_weights) {
	vec4 sampler = texture(p_sampler ,p_triplanar_pos.xy) * p_weights.z;
	sampler += texture(p_sampler ,p_triplanar_pos.xz) * p_weights.y;
	sampler += texture(p_sampler ,p_triplanar_pos.zy * vec2(-1.0, 1.0)) * p_weights.x;
	return sampler;
}

void fragment(){
	vec4 base = triplanar_texture(tex, uv_triplanar_pos, uv_power_normal);
	vec4 nois = texture(noise, UV);
	vec3 lek = vec3(clamp((base.r + base.g + base.b) / 3.0, 0.3, 0.37));
	
	ALBEDO = lek * 0.4;
	METALLIC = 1.0 - (lek.r * 2.0);
	ROUGHNESS = (lek.r * 3.0) - 0.5;
	NORMALMAP = nois.xyz;
}

"

[sub_resource type="OpenSimplexNoise" id=5]
period = 20.0
persistence = 0.7
lacunarity = 4.0

[sub_resource type="NoiseTexture" id=6]
width = 256
height = 256
seamless = true
as_normalmap = true
bump_strength = 1.0
noise = SubResource( 5 )

[sub_resource type="ShaderMaterial" id=12]
shader = SubResource( 2 )
shader_param/tex = ExtResource( 1 )
shader_param/noise = SubResource( 6 )

[sub_resource type="ConcavePolygonShape" id=13]
data = PoolVector3Array( -8, 2, 0.5, 8, 2, 0.5, -8, -2, 0.5, 8, 2, 0.5, 8, -2, 0.5, -8, -2, 0.5, 8, 2, -0.5, -8, 2, -0.5, 8, -2, -0.5, -8, 2, -0.5, -8, -2, -0.5, 8, -2, -0.5, 8, 2, 0.5, 8, 2, -0.5, 8, -2, 0.5, 8, 2, -0.5, 8, -2, -0.5, 8, -2, 0.5, -8, 2, -0.5, -8, 2, 0.5, -8, -2, -0.5, -8, 2, 0.5, -8, -2, 0.5, -8, -2, -0.5, 8, 2, 0.5, -8, 2, 0.5, 8, 2, -0.5, -8, 2, 0.5, -8, 2, -0.5, 8, 2, -0.5, -8, -2, 0.5, 8, -2, 0.5, -8, -2, -0.5, 8, -2, 0.5, 8, -2, -0.5, -8, -2, -0.5 )

[sub_resource type="CubeMesh" id=14]
size = Vector3( 7, 4, 1 )

[sub_resource type="ConcavePolygonShape" id=7]
data = PoolVector3Array( -3.5, 2, 0.5, 3.5, 2, 0.5, -3.5, -2, 0.5, 3.5, 2, 0.5, 3.5, -2, 0.5, -3.5, -2, 0.5, 3.5, 2, -0.5, -3.5, 2, -0.5, 3.5, -2, -0.5, -3.5, 2, -0.5, -3.5, -2, -0.5, 3.5, -2, -0.5, 3.5, 2, 0.5, 3.5, 2, -0.5, 3.5, -2, 0.5, 3.5, 2, -0.5, 3.5, -2, -0.5, 3.5, -2, 0.5, -3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, -2, -0.5, -3.5, 2, 0.5, -3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, 2, 0.5, -3.5, 2, 0.5, 3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, 2, -0.5, 3.5, 2, -0.5, -3.5, -2, 0.5, 3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, -2, 0.5, 3.5, -2, -0.5, -3.5, -2, -0.5 )

[sub_resource type="ConcavePolygonShape" id=8]
data = PoolVector3Array( -3.5, 2, 0.5, 3.5, 2, 0.5, -3.5, -2, 0.5, 3.5, 2, 0.5, 3.5, -2, 0.5, -3.5, -2, 0.5, 3.5, 2, -0.5, -3.5, 2, -0.5, 3.5, -2, -0.5, -3.5, 2, -0.5, -3.5, -2, -0.5, 3.5, -2, -0.5, 3.5, 2, 0.5, 3.5, 2, -0.5, 3.5, -2, 0.5, 3.5, 2, -0.5, 3.5, -2, -0.5, 3.5, -2, 0.5, -3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, -2, -0.5, -3.5, 2, 0.5, -3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, 2, 0.5, -3.5, 2, 0.5, 3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, 2, -0.5, 3.5, 2, -0.5, -3.5, -2, 0.5, 3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, -2, 0.5, 3.5, -2, -0.5, -3.5, -2, -0.5 )

[sub_resource type="ConcavePolygonShape" id=9]
data = PoolVector3Array( -3.5, 2, 0.5, 3.5, 2, 0.5, -3.5, -2, 0.5, 3.5, 2, 0.5, 3.5, -2, 0.5, -3.5, -2, 0.5, 3.5, 2, -0.5, -3.5, 2, -0.5, 3.5, -2, -0.5, -3.5, 2, -0.5, -3.5, -2, -0.5, 3.5, -2, -0.5, 3.5, 2, 0.5, 3.5, 2, -0.5, 3.5, -2, 0.5, 3.5, 2, -0.5, 3.5, -2, -0.5, 3.5, -2, 0.5, -3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, -2, -0.5, -3.5, 2, 0.5, -3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, 2, 0.5, -3.5, 2, 0.5, 3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, 2, -0.5, 3.5, 2, -0.5, -3.5, -2, 0.5, 3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, -2, 0.5, 3.5, -2, -0.5, -3.5, -2, -0.5 )

[sub_resource type="ConcavePolygonShape" id=10]
data = PoolVector3Array( -3.5, 2, 0.5, 3.5, 2, 0.5, -3.5, -2, 0.5, 3.5, 2, 0.5, 3.5, -2, 0.5, -3.5, -2, 0.5, 3.5, 2, -0.5, -3.5, 2, -0.5, 3.5, -2, -0.5, -3.5, 2, -0.5, -3.5, -2, -0.5, 3.5, -2, -0.5, 3.5, 2, 0.5, 3.5, 2, -0.5, 3.5, -2, 0.5, 3.5, 2, -0.5, 3.5, -2, -0.5, 3.5, -2, 0.5, -3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, -2, -0.5, -3.5, 2, 0.5, -3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, 2, 0.5, -3.5, 2, 0.5, 3.5, 2, -0.5, -3.5, 2, 0.5, -3.5, 2, -0.5, 3.5, 2, -0.5, -3.5, -2, 0.5, 3.5, -2, 0.5, -3.5, -2, -0.5, 3.5, -2, 0.5, 3.5, -2, -0.5, -3.5, -2, -0.5 )

[node name="floor" type="MeshInstance"]
mesh = SubResource( 1 )
skeleton = NodePath("../..")
material/0 = null

[node name="MeshInstance5" type="MeshInstance" parent="."]
transform = Transform( -4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, -8.5, 2, 0 )
mesh = SubResource( 11 )
material/0 = SubResource( 12 )

[node name="StaticBody" type="StaticBody" parent="MeshInstance5"]

[node name="CollisionShape" type="CollisionShape" parent="MeshInstance5/StaticBody"]
shape = SubResource( 13 )

[node name="MeshInstance6" type="MeshInstance" parent="."]
transform = Transform( -4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 8.5, 2, 0 )
mesh = SubResource( 11 )
material/0 = SubResource( 12 )

[node name="StaticBody" type="StaticBody" parent="MeshInstance6"]

[node name="CollisionShape" type="CollisionShape" parent="MeshInstance6/StaticBody"]
shape = SubResource( 13 )

[node name="MeshInstance7" type="MeshInstance" parent="."]
transform = Transform( -1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, -5.5, 2, -8.5 )
mesh = SubResource( 14 )
material/0 = ExtResource( 2 )

[node name="StaticBody" type="StaticBody" parent="MeshInstance7"]

[node name="CollisionShape" type="CollisionShape" parent="MeshInstance7/StaticBody"]
shape = SubResource( 7 )

[node name="MeshInstance8" type="MeshInstance" parent="."]
transform = Transform( -1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, 5.5, 2, -8.5 )
mesh = SubResource( 14 )
material/0 = ExtResource( 2 )

[node name="StaticBody" type="StaticBody" parent="MeshInstance8"]

[node name="CollisionShape" type="CollisionShape" parent="MeshInstance8/StaticBody"]
shape = SubResource( 8 )

[node name="MeshInstance9" type="MeshInstance" parent="."]
transform = Transform( -1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, -5.5, 2, 8.5 )
mesh = SubResource( 14 )
material/0 = ExtResource( 2 )

[node name="StaticBody" type="StaticBody" parent="MeshInstance9"]

[node name="CollisionShape" type="CollisionShape" parent="MeshInstance9/StaticBody"]
shape = SubResource( 9 )

[node name="MeshInstance10" type="MeshInstance" parent="."]
transform = Transform( -1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, 5.5, 2, 8.5 )
mesh = SubResource( 14 )
material/0 = ExtResource( 2 )

[node name="StaticBody" type="StaticBody" parent="MeshInstance10"]

[node name="CollisionShape" type="CollisionShape" parent="MeshInstance10/StaticBody"]
shape = SubResource( 10 )
